---
title: "Typescriptã§è¨ˆç®—ã—ãŸçµæœã‚’Github Actionsã«æ¸¡ã—ã¦ä½¿ç”¨ã™ã‚‹"
emoji: "ğŸ¦”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["javascript", "typescript", "GithubActions"]
published: true
---

Github Actions ä¸Šã§ Typescript ã‚’å®Ÿè¡Œã—ã¦ã€ãã®è¨ˆç®—å†…å®¹ã‚’ Github Actions ä¸Šã§ä½¿ç”¨ã—ãŸã„æ™‚ã¨ã‹ã‚ã‚Šã¾ã™ã‚ˆã­ğŸ…

# TL;DR

- Github Actions ã§ Typescript å®Ÿè¡Œ
- @actions/core ã® [setOutput](https://docs.github.com/ja/actions/creating-actions/creating-a-javascript-action#adding-actions-toolkit-packages) ã‚’ä½¿ç”¨

# ä¾‹

æ¯æœ 10 æ™‚ã« aws ã®ã‚³ã‚¹ãƒˆã‚’å–å¾—ã—ã¦ã€aws ã®ã‚³ã‚¹ãƒˆã¯ãƒ‰ãƒ«ãªã®ã§ã€å††ã«ç›´ã—ã¦ slack ã«é€šçŸ¥

â€»ç´°ã‹ã„å–å¾—æ–¹æ³•ã¯ãƒ†ãƒ¼ãƒã§ã¯ãªã„ã®ã§çœç•¥ã—ã¦ã¾ã™

```ts
const awsCost = 100; // ãƒ‰ãƒ«
const rate = 106.1 // ãƒ‰ãƒ«å††
const awsJpyBill = awsCost * JPY
```

â€» awsCost ã‚„ rate ã¯ [aws-sdk ã® CostExplorer](https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/CostExplorer.html)ãªã©ã§å–å¾—ã—ã¦ãã ã•ã„

ä¸Šè¨˜ã®è¨ˆç®—ï¼ˆã»ã¼ã—ã¦ãªã„ã‘ã©ï¼‰ã‚’ã€Github Actions ä¸Šã§ä½¿ç”¨ã—ãŸã„ã¨ãã¯`@actions/core`ã‚’ä½¿ç”¨ã—ã¦æ¸¡ã—ã¾ã™

# æ–¹æ³•

`@actions/core`ã‚’ä½¿ç”¨

# æ‰‹é †

1. @actions/core ã‚’ package.json ã«è¿½åŠ 
1. ã‚³ãƒ¼ãƒ‰å†…ã‹ã‚‰æ¸¡ã™
1. Github Actions ä¸Šã§ä½¿ç”¨

## @actions/core ã‚’ package.json ã«è¿½åŠ 

```bash
npm i @actions/core -D
```

# ã‚³ãƒ¼ãƒ‰å†…ã‹ã‚‰æ¸¡ã™

```ts
import { setOutput } from '@actions/core';ã€€// è¿½åŠ 

const awsCost = 100; // ãƒ‰ãƒ«
const rate = 106.1 // ãƒ‰ãƒ«å††
const awsJpyBill = awsCost * JPY

setOutput("awsCost", awsCost) ã€€// è¿½åŠ 
setOutput("rate", rate) ã€€// è¿½åŠ 
setOutput("awsJpyBill", awsJpyBill) ã€€// è¿½åŠ 
```

# Github Actions ä¸Šã§ä½¿ç”¨

```yml
name: Create AWS Bill

on:
  schedule:
    - cron: '0 1 * * *' # æ¯æ—¥ am10æ™‚
  workflow_dispatch:
    branches: [master] # Githubã®ç”»é¢ã‹ã‚‰æ‰‹å‹•ã§ã‚‚å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«

env:
  SLACK_ICON: https://raw.githubusercontent.com/quintessence/slack-icons/master/images/octocat-spock-slack-icon.png

jobs:
  notify-aws-cost:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
			- uses: actions/setup-node@v1
				with:
					node-version: '14'

      - name: Install Dependency
        run: npm ci

      - name: Get AWS Cost
        id: get-bill
        run: npx ts-node get-aws-cost.ts

      - name: Slack notification
        uses: rtCamp/action-slack-notify@master
        env:
          SLACK_ICON: ${{ env.SLACK_ICON }}
          SLACK_MESSAGE: AWSã®ã‚³ã‚¹ãƒˆã¯ ${{ steps.get-bill.outputs.awsCost }}ãƒ‰ãƒ« ã§ ${{ steps.get-bill.outputs.awsJpyBill }} ãƒ¬ãƒ¼ãƒˆã¯(${{steps.get-bill.outputs.rate}})å††
```

## ãƒã‚¤ãƒ³ãƒˆ

- ts ã®å®Ÿè¡Œç®‡æ‰€ã« id(get-bill)ã‚’è¨­å®š
- `${{ steps.<steps_id>.outputs.<setOutputã§è¨­å®šã—ãŸåç§°>}}`ã§ã€ts å†…ã§è¨­å®šã—ãŸå€¤ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ğŸ…

## å‚ç…§

https://docs.github.com/ja/actions/creating-actions/creating-a-javascript-action#testing-out-your-action-in-a-workflow
